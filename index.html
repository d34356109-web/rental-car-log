<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è»Šè¼›è¨‚å–®ç®¡ç†ç³»çµ±</title>
    
    <!-- Tailwind CSS (æ¨£å¼åº«) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è§£æ±º React åœ¨ç€è¦½å™¨ç›´æ¥é‹è¡Œçš„ç›¸ä¾æ€§å•é¡Œ -->
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.2.0",
          "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
          "lucide-react": "https://esm.sh/lucide-react@0.292.0",
          "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
          "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
          "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
        }
      }
    </script>
    
    <!-- Babel (è®“ç€è¦½å™¨çœ‹æ‡‚ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background-color: #f8fafc; }
        /* éš±è—æœªè¼‰å…¥æ™‚çš„é–ƒçˆ */
        #root:empty { display: none; }
        .transition-max-height { transition: max-height 0.3s ease-in-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- ä¸»ç¨‹å¼é‚è¼¯ -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Calendar, Car, Users, CreditCard, Snowflake, Sun,
            Plus, Search, Edit3, Trash2, Clock, Save, X, 
            LogOut, ShieldCheck, Database, CheckCircle, ArrowRight, AlertCircle,
            ChevronDown, ChevronUp, BellRing, AlertTriangle, MapPin
        } from 'lucide-react';

        // --- Firebase SDK ---
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
        import { 
            getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, 
            serverTimestamp 
        } from 'firebase/firestore';

        // ğŸ”´ è«‹åœ¨é€™è£¡å¡«å…¥æ‚¨çš„ Firebase è¨­å®š (ä¿ç•™å¼•è™Ÿ) ğŸ”´
        const firebaseConfig = {
            apiKey: "AIzaSyDq65URVL5sppv-2yXBh8DQuEwaXm5u5k0",
            authDomain: "myrentalcarsystem-a88fb.firebaseapp.com",
            projectId: "myrentalcarsystem-a88fb",
            storageBucket: "myrentalcarsystem-a88fb.firebasestorage.app",
            messagingSenderId: "1076727464488",
            appId: "1:1076727464488:web:9599c788414f5211896b1d"
        };

        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- é è¨­è³‡æ–™ (å·²æ ¹æ“šåœ–ç‰‡ image_6c7a5e.png æ›´æ–°) ---
        const INITIAL_VEHICLES_SEED = [
            { location: 'æˆç”°', plate: 'æˆç”°330ã‚888', brand: 'Toyota', model: 'Vellfire', feature: 'HEV 4WD', seats: 8, etc: '8001 6161 4861 3901 001', tire: 'å†¬æ¸ˆ' },
            { location: 'æˆç”°', plate: 'å’Œæ³‰330ã‚2222', brand: 'Toyota', model: 'Alphard', feature: '', seats: 8, etc: '8001 6161 4860 7900 000', tire: 'å†¬æ¸ˆ' },
            { location: 'æˆç”°', plate: 'ãªã«ã‚334ã‚8888', brand: 'Toyota', model: 'Alphard', feature: '40ç³» Captain', seats: 7, etc: '7804 2150 2134 9280', tire: 'å†¬æ¸ˆ' },
            { location: 'æˆç”°', plate: 'å’Œæ³‰333ã‚1111', brand: 'Toyota', model: 'Vellfire', feature: '', seats: 7, etc: '8001 6161 4861 9900 000', tire: 'å†¬æ¸ˆ' },
            { location: 'æˆç”°', plate: 'ãªã«ã‚335ã‚8888', brand: 'Toyota', model: 'Alphard', feature: 'HEV 4WD', seats: 8, etc: '8001 6161 4860 6901 000', tire: 'å†¬æ¸ˆ' },
            { location: 'æˆç”°', plate: 'å“å·302ã‚2282', brand: 'Toyota', model: 'Alphard', feature: '', seats: 7, etc: '8026 8702 5853 4820 000', tire: 'å†¬æ¸ˆ' },
            { location: 'æˆç”°', plate: 'å“å·302ã‚6466', brand: 'Toyota', model: 'Alphard', feature: 'HEV', seats: 7, etc: '7070 3000 2295 9138', tire: 'å¤æ¸ˆ' },
            { location: 'æˆç”°', plate: 'æŸ300ã‚2258', brand: 'Toyota', model: 'Alphard', feature: '', seats: 7, etc: '8001 6161 4861 4901 000', tire: 'å†¬æ¸ˆ' },
            { location: 'æˆç”°', plate: 'æŸ300ã‚2588', brand: 'Toyota', model: 'Alphard', feature: '', seats: 7, etc: '8001 6161 4860 9901 007', tire: 'å†¬æ¸ˆ' },
            { location: 'æˆç”°', plate: 'æŸ300ã‚2599', brand: 'Toyota', model: 'Alphard', feature: '4WD', seats: 7, etc: '8001 6161 4860 0901 006', tire: 'å†¬æ¸ˆ' },
        ];

        // å¸¸ç”¨åœ°é»é¸é …
        const PRESET_LOCATIONS = ["æˆç”°äºŒèˆª", "æˆç”°ä¸€èˆª", "ç¾½ç”°"];

        // --- React Component ---
        function VehicleOrderSystem() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [vehicles, setVehicles] = useState([]);
            const [orders, setOrders] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            
            // è‡ªè¨‚å½ˆå‡ºè¦–çª—ç‹€æ…‹ (å–ä»£ alert èˆ‡ confirm)
            const [dialog, setDialog] = useState({ isOpen: false, message: '', type: 'alert', onConfirm: null });

            // UI State for Expanded Cards
            const [expandedCards, setExpandedCards] = useState({});

            const [isOrderModalOpen, setIsOrderModalOpen] = useState(false);
            const [editingOrder, setEditingOrder] = useState(null);
            const [isVehicleModalOpen, setIsVehicleModalOpen] = useState(false);
            const [editingVehicle, setEditingVehicle] = useState(null);
            
            const [searchTerm, setSearchTerm] = useState('');
            const [filterDate, setFilterDate] = useState(new Date().toISOString().split('T')[0]);

            const [orderFormData, setOrderFormData] = useState({
                customer: '', start: '', end: '', vehicleId: '', note: '', status: 'confirmed',
                pickupLocation: '', returnLocation: ''
            });
            const [vehicleFormData, setVehicleFormData] = useState({
                location: 'æˆç”°', plate: '', brand: 'Toyota', model: 'Alphard', feature: '', seats: 7, etc: '', tire: 'å†¬æ¸ˆ'
            });
            const [newEtcNumber, setNewEtcNumber] = useState('');

            // è‡ªè¨‚å½ˆå‡ºè¦–çª—å·¥å…·å‡½å¼
            const showAlert = (message) => setDialog({ isOpen: true, message, type: 'alert', onConfirm: null });
            const showConfirm = (message, onConfirm) => setDialog({ isOpen: true, message, type: 'confirm', onConfirm });

            // Auth & Sync
            useEffect(() => {
                signInAnonymously(auth).catch(console.error);
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    if (currentUser) {
                        const unsubVehicles = onSnapshot(collection(db, 'vehicles'), (snap) => {
                            setVehicles(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                            setIsLoading(false);
                        });
                        const unsubOrders = onSnapshot(collection(db, 'orders'), (snap) => {
                            setOrders(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                        });
                        return () => { unsubVehicles(); unsubOrders(); };
                    } else {
                        setIsLoading(false);
                    }
                });
                return () => unsubscribe();
            }, []);

            // Toggle Expand
            const toggleExpand = (id) => {
                setExpandedCards(prev => ({
                    ...prev,
                    [id]: !prev[id]
                }));
            };

            // Helpers
            const formatDateTime = (iso) => {
                if (!iso) return '';
                const d = new Date(iso);
                return `${d.getFullYear()}/${(d.getMonth()+1).toString().padStart(2,'0')}/${d.getDate().toString().padStart(2,'0')} ${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
            };
            
            const formatTimeOnly = (iso) => {
                if (!iso) return '';
                const d = new Date(iso);
                return `${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
            };

            // å–å¾—ç•¶æ—¥è¨‚å–® (ç”¨æ–¼è¨ˆç®—ç‹€æ…‹)
            const getDayOrders = (vid, dateStr) => {
                const startOfDay = new Date(`${dateStr}T00:00:00`);
                const endOfDay = new Date(`${dateStr}T23:59:59`);
                return orders
                    .filter(o => o.vehicleId === vid && o.status !== 'cancelled' && new Date(o.start) < endOfDay && new Date(o.end) > startOfDay)
                    .sort((a, b) => new Date(a.start) - new Date(b.start));
            };

            // å–å¾—å®Œæ•´æ’ç¨‹ (ç•¶æ—¥ + æœªä¾†ï¼Œç”¨æ–¼å±•é–‹åˆ—è¡¨)
            const getVehicleSchedule = (vid, dateStr) => {
                const startOfDay = new Date(`${dateStr}T00:00:00`);
                return orders
                    .filter(o => o.vehicleId === vid && o.status !== 'cancelled' && new Date(o.end) > startOfDay)
                    .sort((a, b) => new Date(a.start) - new Date(b.start));
            };

            const isVehicleAvailable = (vid, start, end, excludeId) => {
                const s = new Date(start);
                const e = new Date(end);
                return !orders.some(o => o.vehicleId === vid && o.id !== excludeId && o.status !== 'cancelled' && s < new Date(o.end) && e > new Date(o.start));
            };

            const isOrderActiveNow = (order) => {
                const now = new Date();
                const start = new Date(order.start);
                const end = new Date(order.end);
                return now >= start && now <= end;
            };

            // Sorting Logic for Dashboard
            const sortedVehicles = useMemo(() => {
                const vehiclesWithStatus = vehicles.map(v => {
                    const dayOrders = getDayOrders(v.id, filterDate);
                    const activeOrder = dayOrders.find(o => isOrderActiveNow(o));
                    const now = new Date();
                    // æ³¨æ„ï¼šé€™è£¡åªå¾ dayOrders (ç•¶æ—¥è¨‚å–®) ç¯©é¸å‡ºç•¶æ—¥é‚„æ²’é–‹å§‹çš„è¨‚å–®ï¼Œä½œç‚ºç•¶æ—¥çš„æœªä¾†é ç´„
                    const futureOrders = dayOrders.filter(o => !isOrderActiveNow(o) && new Date(o.start) > now);
                    
                    // æ±ºå®šæ’åºæ¬Šé‡ (è¶Šå°è¶Šå‰é¢)
                    let sortWeight = 999; 
                    let sortTime = 0; 

                    if (activeOrder) {
                        // ç¬¬ä¸€å„ªå…ˆï¼šæ­£åœ¨å‡ºç§Ÿ (çœ‹èª°å…ˆé‚„è»Š)
                        sortWeight = 1;
                        sortTime = new Date(activeOrder.end).getTime();
                    } else if (futureOrders.length > 0) {
                        // ç¬¬äºŒå„ªå…ˆï¼šç•¶æ—¥å³å°‡æœ‰é ç´„ (çœ‹èª°å…ˆäº¤è»Š)
                        sortWeight = 2;
                        sortTime = new Date(futureOrders[0].start).getTime();
                    } else {
                        // ç¬¬ä¸‰ï¼šç©ºè»Š (ç•¶æ—¥å®Œå…¨æ²’äº‹ï¼Œæˆ–å·²å›åº«)
                        sortWeight = 3;
                    }

                    return { ...v, dayOrders, activeOrder, futureOrders, sortWeight, sortTime };
                });

                return vehiclesWithStatus.sort((a, b) => {
                    if (a.sortWeight !== b.sortWeight) return a.sortWeight - b.sortWeight;
                    return a.sortTime - b.sortTime;
                });
            }, [vehicles, orders, filterDate]);

            // è¨ˆç®—é¸å®šæ—¥æœŸçš„çœŸæ­£ç©ºè»Š (ç•¶ä¸‹æœªå‡ºç§Ÿï¼Œä¸”ç•¶æ—¥å¾ŒçºŒç„¡é ç´„)
            const availableVehicles = useMemo(() => {
                return sortedVehicles.filter(v => !v.activeOrder && v.futureOrders.length === 0);
            }, [sortedVehicles]);

            // ä¸€é€±å…§è¡Œç¨‹æé†’é‚è¼¯ (å·²æ’é™¤éå»æ™‚é–“)
            const weeklyReminders = useMemo(() => {
                const now = new Date(); 
                const startWindow = new Date(`${filterDate}T00:00:00`);
                const endWindow = new Date(startWindow);
                endWindow.setDate(endWindow.getDate() + 7);

                const events = [];
                orders.forEach(o => {
                    if (o.status === 'cancelled') return;
                    
                    const startDate = new Date(o.start);
                    const endDate = new Date(o.end);
                    const vehicle = vehicles.find(v => v.id === o.vehicleId);
                    
                    if (!vehicle) return;

                    // æª¢æŸ¥äº¤è»Š (Pickup) - éœ€åœ¨æœå°‹å€é–“å…§ ä¸” æ™šæ–¼ç¾åœ¨æ™‚é–“
                    if (startDate >= startWindow && startDate <= endWindow && startDate > now) {
                        events.push({
                            id: `start-${o.id}`,
                            type: 'pickup',
                            time: startDate,
                            order: o,
                            vehicle: vehicle
                        });
                    }

                    // æª¢æŸ¥é‚„è»Š (Return) - éœ€åœ¨æœå°‹å€é–“å…§ ä¸” æ™šæ–¼ç¾åœ¨æ™‚é–“
                    if (endDate >= startWindow && endDate <= endWindow && endDate > now) {
                        events.push({
                            id: `end-${o.id}`,
                            type: 'return',
                            time: endDate,
                            order: o,
                            vehicle: vehicle
                        });
                    }
                });

                return events.sort((a, b) => a.time - b.time);
            }, [orders, vehicles, filterDate]);


            // Actions
            const handleSaveOrder = async (e) => {
                e.preventDefault();
                if (!orderFormData.customer || !orderFormData.start || !orderFormData.end || !orderFormData.vehicleId) return showAlert("è«‹å¡«å¯«å¿…å¡«æ¬„ä½");
                if (new Date(orderFormData.start) >= new Date(orderFormData.end)) return showAlert("æ™‚é–“éŒ¯èª¤");
                if (!isVehicleAvailable(orderFormData.vehicleId, orderFormData.start, orderFormData.end, editingOrder?.id)) return showAlert("è©²æ™‚æ®µè»Šè¼›å·²è¢«é ç´„");

                try {
                    const data = { ...orderFormData, updatedAt: serverTimestamp() };
                    if (editingOrder) await updateDoc(doc(db, 'orders', editingOrder.id), data);
                    else await addDoc(collection(db, 'orders'), { ...data, createdAt: serverTimestamp() });
                    setIsOrderModalOpen(false);
                } catch (err) { showAlert("å„²å­˜å¤±æ•—: " + err.message); }
            };

            const handleDeleteOrder = (id) => {
                showConfirm("ç¢ºå®šåˆªé™¤?", async () => { 
                    await deleteDoc(doc(db, 'orders', id)); 
                });
            };

            const handleSaveVehicle = async (e) => {
                e.preventDefault();
                try {
                    const data = { ...vehicleFormData, updatedAt: serverTimestamp() };
                    if (editingVehicle) await updateDoc(doc(db, 'vehicles', editingVehicle.id), data);
                    else await addDoc(collection(db, 'vehicles'), { ...data, createdAt: serverTimestamp() });
                    setIsVehicleModalOpen(false);
                } catch (err) { showAlert("å„²å­˜å¤±æ•—"); }
            };

            const handleDeleteVehicle = (id) => {
                showConfirm("ç¢ºå®šåˆªé™¤?", async () => { 
                    await deleteDoc(doc(db, 'vehicles', id)); 
                });
            };

            const handleSeedData = () => {
                showConfirm(`ç¢ºå®šåŒ¯å…¥ ${INITIAL_VEHICLES_SEED.length} å°è»Šè¼›?`, async () => {
                    try {
                        const existingPlates = vehicles.map(v => v.plate);
                        const newVehicles = INITIAL_VEHICLES_SEED.filter(v => !existingPlates.includes(v.plate));
                        if (newVehicles.length === 0) return showAlert("é è¨­è»Šè¼›å·²å­˜åœ¨ï¼Œç„¡éœ€åŒ¯å…¥");
                        await Promise.all(newVehicles.map(v => addDoc(collection(db, 'vehicles'), { ...v, createdAt: serverTimestamp() })));
                        showAlert(`æˆåŠŸåŒ¯å…¥ ${newVehicles.length} å°æ–°è»Šè¼›ï¼`);
                    } catch (e) { showAlert("å¤±æ•—: " + e.message); }
                });
            };

            if (isLoading) return <div className="min-h-screen flex items-center justify-center text-slate-500">è¼‰å…¥è³‡æ–™ä¸­...</div>;

            return (
                <div className="pb-20 md:pb-0">
                    {/* å…±ç”¨å½ˆå‡ºè¦–çª— */}
                    {dialog.isOpen && (
                        <div className="fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm">
                            <div className="bg-white rounded-xl p-6 max-w-sm w-full shadow-2xl transform transition-all">
                                <h3 className="font-bold text-lg mb-3 text-slate-800 flex items-center gap-2">
                                    {dialog.type === 'confirm' ? <AlertTriangle className="text-yellow-500 w-5 h-5"/> : <AlertCircle className="text-blue-500 w-5 h-5"/>}
                                    {dialog.type === 'confirm' ? 'è«‹ç¢ºèª' : 'ç³»çµ±æç¤º'}
                                </h3>
                                <p className="text-slate-600 mb-6">{dialog.message}</p>
                                <div className="flex justify-end gap-3">
                                    {dialog.type === 'confirm' && (
                                        <button onClick={() => setDialog({ isOpen: false, message: '', type: 'alert', onConfirm: null })} className="px-4 py-2 border border-slate-300 rounded-lg hover:bg-slate-50 text-sm font-medium text-slate-700 transition-colors">å–æ¶ˆ</button>
                                    )}
                                    <button onClick={() => {
                                        if (dialog.type === 'confirm' && dialog.onConfirm) dialog.onConfirm();
                                        setDialog({ isOpen: false, message: '', type: 'alert', onConfirm: null });
                                    }} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium transition-colors shadow-sm">ç¢ºå®š</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <nav className="bg-slate-900 text-white p-4 sticky top-0 z-20 flex justify-between items-center shadow">
                        <div className="flex items-center gap-2 font-bold"><Car className="text-blue-400"/> èª¿åº¦ç³»çµ±</div>
                        <div className="text-xs text-gray-400 flex items-center gap-1">
                            {user ? <span className="text-green-400">â— ç·šä¸Š</span> : <span>é€£ç·šä¸­...</span>}
                        </div>
                    </nav>

                    <main className="p-4 max-w-5xl mx-auto">
                        {vehicles.length < 10 && !isLoading && (
                            <div className="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg flex justify-between items-center">
                                <span className="text-sm text-blue-800">å¿«é€Ÿé–‹å§‹ï¼šè³‡æ–™åº«ä¼¼ä¹ç¼ºå°‘éƒ¨åˆ†é è¨­è»Šè¼›ï¼Œæ˜¯å¦è£œé½Šï¼Ÿ</span>
                                <button onClick={handleSeedData} className="px-3 py-1 bg-blue-600 text-white text-xs rounded shadow-sm">ä¸€éµè£œé½Šè³‡æ–™</button>
                            </div>
                        )}

                        {activeTab === 'dashboard' && (
                            <div className="space-y-4">
                                {/* çœ‹æ¿ Header & åœ¨åº«å°æé†’ */}
                                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center bg-white p-3 rounded shadow-sm gap-3">
                                    <div className="flex-1">
                                        <h2 className="font-bold flex items-center gap-2"><BellRing size={18} className="text-blue-600"/> è»Šè¼›èª¿åº¦çœ‹æ¿</h2>
                                        <div className="text-xs text-slate-600 mt-1.5 flex flex-wrap items-center gap-1.5">
                                            <span className="font-semibold text-green-700 bg-green-100 px-2 py-0.5 rounded border border-green-200">
                                                ç›®å‰åœ¨åº«ç©ºè»Š ({availableVehicles.length} è¼›)
                                            </span>
                                            <span className="leading-relaxed">
                                                {availableVehicles.length > 0 
                                                    ? availableVehicles.map(v => v.plate).join('ã€') 
                                                    : 'ç›®å‰ç„¡ç©ºè»Š'}
                                            </span>
                                        </div>
                                    </div>
                                    <input type="date" value={filterDate} onChange={e=>setFilterDate(e.target.value)} className="border border-slate-300 rounded-lg p-1.5 font-medium text-slate-700 text-sm shadow-sm w-full sm:w-auto" />
                                </div>

                                {/* æœªä¾†ä¸€é€±æé†’å€å¡Š */}
                                <div className="bg-slate-50 border border-slate-200 rounded-lg overflow-hidden">
                                    <div className="bg-slate-100 px-3 py-2 text-xs font-bold text-slate-600 flex justify-between items-center border-b border-slate-200">
                                        <span>æœªä¾† 7 æ—¥è¡Œç¨‹æé†’ ({weeklyReminders.length})</span>
                                        <span className="text-[10px] text-slate-400">ä¾æ™‚é–“æ’åº (å·²éš±è—éæœŸ)</span>
                                    </div>
                                    <div className="max-h-40 overflow-y-auto divide-y divide-slate-100">
                                        {weeklyReminders.length === 0 ? (
                                            <div className="p-4 text-center text-xs text-slate-400 italic">æœªä¾†ä¸€é€±ç„¡å¾…è¾¦è¡Œç¨‹</div>
                                        ) : (
                                            weeklyReminders.map(evt => (
                                                <div key={evt.id} className="p-2 flex items-center gap-3 hover:bg-white text-sm">
                                                    <div className={`text-[10px] font-bold px-1.5 py-0.5 rounded whitespace-nowrap w-12 text-center ${evt.type === 'pickup' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}`}>
                                                        {evt.type === 'pickup' ? 'ğŸŸ¡ äº¤è»Š' : 'ğŸ”´ é‚„è»Š'}
                                                    </div>
                                                    <div className="flex-1">
                                                        <div className="flex justify-between">
                                                            <div className="flex items-center gap-2">
                                                                <span className="font-bold text-slate-700">{formatDateTime(evt.time)}</span>
                                                                {/* é¡¯ç¤ºåœ°é» */}
                                                                <span className="text-xs text-slate-500 bg-slate-100 px-1 rounded border border-slate-200 flex items-center gap-0.5">
                                                                    <MapPin size={10}/>
                                                                    {evt.type === 'pickup' ? (evt.order.pickupLocation || 'æœªæŒ‡å®š') : (evt.order.returnLocation || 'æœªæŒ‡å®š')}
                                                                </span>
                                                            </div>
                                                            <span className="text-xs text-slate-500 font-medium">{evt.vehicle.plate}</span>
                                                        </div>
                                                        <div className="text-xs text-slate-500 truncate mt-0.5">
                                                            {evt.order.customer} 
                                                            <span className="text-slate-300 mx-1">|</span> 
                                                            {evt.vehicle.model}
                                                            {evt.order.note && (
                                                                <>
                                                                    <span className="text-slate-300 mx-1">|</span>
                                                                    <span className="text-gray-400">å‚™è¨»: {evt.order.note}</span>
                                                                </>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>

                                <div className="text-xs text-gray-500 px-2 flex justify-between pt-2">
                                    <span>æ’åºï¼šğŸ”´é‚„è»Šå„ªå…ˆ -> ğŸŸ¡äº¤è»Šå„ªå…ˆ -> ğŸŸ¢ç©ºè»Š</span>
                                </div>
                                <div className="space-y-3">
                                    {sortedVehicles.map(v => {
                                        const dayOrders = v.dayOrders; // ç•¶æ—¥è¡Œç¨‹
                                        const scheduleOrders = getVehicleSchedule(v.id, filterDate); // å®Œæ•´æ’ç¨‹ (å«æœªä¾†)
                                        
                                        const activeOrder = v.activeOrder;
                                        const futureOrders = v.futureOrders; // ç•¶æ—¥ä¸­ï¼Œé‚„æ²’é–‹å§‹çš„è¨‚å–®
                                        const isRentedNow = !!activeOrder;
                                        const isExpanded = !!expandedCards[v.id];

                                        return (
                                            <div 
                                                key={v.id} 
                                                className={`bg-white rounded shadow-sm border-l-4 transition-all duration-200 cursor-pointer hover:shadow-md
                                                    ${isRentedNow ? 'border-l-red-500' : (futureOrders.length > 0 ? 'border-l-yellow-400' : 'border-l-green-500')}
                                                `}
                                                onClick={() => toggleExpand(v.id)}
                                            >
                                                {/* Card Header */}
                                                <div className="p-4">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <div className="font-bold text-lg text-slate-800">{v.plate}</div>
                                                            <div className="text-sm text-gray-500">
                                                                {v.model} {v.feature ? ` / ${v.feature}` : ''} {v.tire ? ` (${v.tire})` : ''} {v.seats ? ` / ${v.seats} åº§` : ''}
                                                            </div>
                                                        </div>
                                                        
                                                        {/* Status Badges (Stacked) */}
                                                        <div className="flex flex-col items-end gap-1">
                                                            {(!isRentedNow && futureOrders.length === 0) && (
                                                                <span className="text-xs px-2 py-1 rounded bg-green-100 text-green-700 font-bold border border-green-200">ğŸŸ¢ ç›®å‰ç©ºè»Š</span>
                                                            )}
                                                            {isRentedNow && (
                                                                <span className="text-xs px-2 py-1 rounded bg-red-100 text-red-700 font-bold animate-pulse flex items-center gap-1">
                                                                    <Clock size={12}/> å‡ºç§Ÿä¸­
                                                                </span>
                                                            )}
                                                            {/* åªè¦è¡Œç¨‹è¡¨è£¡æœ‰æœªä¾†çš„è¨‚å–®ï¼Œå°±é¡¯ç¤ºé ç´„è¨‚å–®æ¨™ç±¤ */}
                                                            {scheduleOrders.some(o => new Date(o.start) > new Date()) && (
                                                                <span className="text-xs px-2 py-1 rounded bg-yellow-100 text-yellow-700 font-bold flex items-center gap-1">
                                                                    <AlertCircle size={12}/> é ç´„è¨‚å–®
                                                                </span>
                                                            )}
                                                            <div className="mt-1 text-gray-400">
                                                                {isExpanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}
                                                            </div>
                                                        </div>
                                                    </div>

                                                    {/* Key Time Reminder (Always Visible) */}
                                                    {!isExpanded && (
                                                        <div className="mt-2 pt-2 border-t border-dashed border-gray-100">
                                                            {activeOrder ? (
                                                                <div className="flex items-center gap-2 text-sm">
                                                                    <span className="px-1.5 py-0.5 rounded bg-red-100 text-red-700 text-xs font-bold whitespace-nowrap">é‚„è»Š</span>
                                                                    <span className="font-medium text-slate-800">{formatDateTime(activeOrder.end)}</span>
                                                                    <span className="text-xs text-slate-500 bg-slate-100 px-1 rounded flex items-center">
                                                                        <MapPin size={10} className="mr-0.5"/> {activeOrder.returnLocation || 'æœªæŒ‡å®š'}
                                                                    </span>
                                                                    <span className="text-gray-500 text-xs ml-auto">({activeOrder.customer})</span>
                                                                </div>
                                                            ) : futureOrders.length > 0 ? (
                                                                <div className="flex items-center gap-2 text-sm">
                                                                    <span className="px-1.5 py-0.5 rounded bg-yellow-100 text-yellow-700 text-xs font-bold whitespace-nowrap">äº¤è»Š</span>
                                                                    <span className="font-medium text-slate-800">{formatDateTime(futureOrders[0].start)}</span>
                                                                    <span className="text-xs text-slate-500 bg-slate-100 px-1 rounded flex items-center">
                                                                        <MapPin size={10} className="mr-0.5"/> {futureOrders[0].pickupLocation || 'æœªæŒ‡å®š'}
                                                                    </span>
                                                                    <span className="text-gray-500 text-xs ml-auto">({futureOrders[0].customer})</span>
                                                                </div>
                                                            ) : dayOrders.length > 0 ? (
                                                                <div className="flex items-center gap-2 text-sm">
                                                                    <span className="px-1.5 py-0.5 rounded bg-green-100 text-green-700 text-xs font-bold whitespace-nowrap border border-green-200">å·²å›åº«</span>
                                                                    <span className="font-medium text-slate-800">{formatDateTime(dayOrders[dayOrders.length - 1].end)}</span>
                                                                    <span className="text-gray-500 text-xs ml-auto">å‰å–®å·²çµï¼Œå¯éš¨æ™‚æ´¾å–®</span>
                                                                </div>
                                                            ) : (
                                                                <div className="text-xs text-gray-400 italic">å…¨æ—¥ç„¡æ’ç¨‹ï¼Œå¯éš¨æ™‚æ´¾å–®</div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>

                                                {/* Expanded Details - Schedule List */}
                                                {isExpanded && (
                                                    <div className="px-4 pb-4 border-t bg-slate-50 rounded-b" onClick={(e) => e.stopPropagation()}>
                                                        <div className="space-y-3 pt-3">
                                                            <div className="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">è©³ç´°è¡Œç¨‹è¡¨ (å«æœªä¾†é ç´„)</div>
                                                            
                                                            {scheduleOrders.map((order, idx) => {
                                                                const active = isOrderActiveNow(order);
                                                                const isFuture = new Date(order.start) > new Date();
                                                                
                                                                let statusColor = "bg-white border-gray-200";
                                                                let textColor = "text-gray-600";
                                                                let label = "å·²çµæŸ";
                                                                let labelClass = "bg-gray-100 text-gray-500";
                                                                
                                                                if (active) {
                                                                    statusColor = "bg-red-50 border-red-200 shadow-sm";
                                                                    textColor = "text-red-700";
                                                                    label = "é€²è¡Œä¸­";
                                                                    labelClass = "bg-red-100 text-red-700 font-bold";
                                                                } else if (isFuture) {
                                                                    statusColor = "bg-yellow-50 border-yellow-200";
                                                                    textColor = "text-yellow-700";
                                                                    label = "é ç´„";
                                                                    labelClass = "bg-yellow-100 text-yellow-700 font-bold";
                                                                }

                                                                return (
                                                                    <div key={order.id} className={`text-sm p-3 rounded border flex justify-between items-start ${statusColor}`}>
                                                                        <div className="flex-1">
                                                                            <div className="flex justify-between items-center mb-1">
                                                                                <div className={`font-medium flex items-center gap-2 ${textColor} text-base`}>
                                                                                    {order.customer}
                                                                                    <span className={`text-[10px] px-2 py-0.5 rounded border ${labelClass}`}>
                                                                                        {label}
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                            <div className="text-sm text-slate-700 mt-1 space-y-1">
                                                                                <div className="flex items-center gap-2">
                                                                                    <span className="text-green-600 font-medium text-xs w-8">å–è»Š</span>
                                                                                    {formatDateTime(order.start)}
                                                                                    <span className="text-xs text-slate-500 bg-slate-50 px-1 rounded border">@{order.pickupLocation || 'æœªæŒ‡å®š'}</span>
                                                                                </div>
                                                                                <div className="flex items-center gap-2">
                                                                                    <span className="text-red-600 font-medium text-xs w-8">é‚„è»Š</span>
                                                                                    {formatDateTime(order.end)}
                                                                                    <span className="text-xs text-slate-500 bg-slate-50 px-1 rounded border">@{order.returnLocation || 'æœªæŒ‡å®š'}</span>
                                                                                </div>
                                                                                {/* å‚™è¨»é¡¯ç¤º */}
                                                                                {order.note && (
                                                                                    <div className="text-xs text-gray-500 mt-2 bg-yellow-50 p-2 rounded border border-yellow-100">
                                                                                        <span className="font-semibold text-gray-600">å‚™è¨»ï¼š</span>{order.note}
                                                                                    </div>
                                                                                )}
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                );
                                                            })}

                                                            <button onClick={()=>{
                                                                setEditingOrder(null);
                                                                let defaultStart = `${filterDate}T10:00`;
                                                                if (dayOrders.length > 0) {
                                                                    const lastEnd = new Date(dayOrders[dayOrders.length-1].end);
                                                                    lastEnd.setHours(lastEnd.getHours() + 1);
                                                                    const y = lastEnd.getFullYear();
                                                                    const m = String(lastEnd.getMonth() + 1).padStart(2, '0');
                                                                    const d = String(lastEnd.getDate()).padStart(2, '0');
                                                                    const h = String(lastEnd.getHours()).padStart(2, '0');
                                                                    const min = String(lastEnd.getMinutes()).padStart(2, '0');
                                                                    defaultStart = `${y}-${m}-${d}T${h}:${min}`;
                                                                }
                                                                setOrderFormData({
                                                                    customer:'', 
                                                                    start: defaultStart, 
                                                                    end: '',
                                                                    vehicleId: v.id, 
                                                                    note:'', 
                                                                    status:'confirmed',
                                                                    pickupLocation: 'æˆç”°äºŒèˆª',
                                                                    returnLocation: 'æˆç”°äºŒèˆª'
                                                                });
                                                                setIsOrderModalOpen(true);
                                                            }} className="mt-4 w-full py-2.5 text-sm font-medium border border-dashed border-blue-400 text-blue-600 rounded bg-white hover:bg-blue-50 flex items-center justify-center gap-2 transition-colors shadow-sm">
                                                                <Plus size={16}/> æ´¾å–®
                                                            </button>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>
                        )}

                        {activeTab === 'vehicles' && (
                            <div className="space-y-4">
                                <button onClick={()=>{setEditingVehicle(null); setVehicleFormData({location: 'æˆç”°', plate: '', brand: 'Toyota', model: 'Alphard', feature: '', seats: 7, etc: '', tire: 'å†¬æ¸ˆ'}); setIsVehicleModalOpen(true)}} className="w-full py-3 bg-blue-600 text-white rounded shadow font-bold flex justify-center gap-2"><Plus/> æ–°å¢è»Šè¼›</button>
                                {vehicles.map(v => (
                                    <div key={v.id} className="bg-white p-4 rounded shadow-sm flex justify-between items-center">
                                        <div>
                                            <div className="font-bold">{v.plate} <span className="text-xs text-gray-500">({v.location})</span></div>
                                            <div className="text-sm text-gray-500">
                                                {v.model} 
                                                {v.feature ? ` / ${v.feature}` : ''}
                                                {v.tire ? ` (${v.tire})` : ''}
                                                {v.seats ? ` / ${v.seats} åº§` : ''}
                                            </div>
                                            <div className="text-xs bg-gray-100 inline-block px-1 rounded mt-1">ETC: {v.etc||'ç„¡'}</div>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={()=>{setEditingVehicle(v); setVehicleFormData(v); setIsVehicleModalOpen(true)}} className="p-2 text-gray-400 hover:text-blue-600"><Edit3 size={18}/></button>
                                            <button onClick={()=>handleDeleteVehicle(v.id)} className="p-2 text-gray-400 hover:text-red-600"><Trash2 size={18}/></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'orders' && (
                            <div className="space-y-4">
                                <button onClick={()=>{setEditingOrder(null); setOrderFormData({customer:'', start:'', end:'', vehicleId:'', note:'', status:'confirmed', pickupLocation: 'æˆç”°äºŒèˆª', returnLocation: 'æˆç”°äºŒèˆª'}); setIsOrderModalOpen(true)}} className="w-full py-3 bg-blue-600 text-white rounded shadow font-bold flex justify-center gap-2"><Plus/> æ–°å¢è¨‚å–®</button>
                                {orders.sort((a,b)=>new Date(b.start)-new Date(a.start)).map(o => {
                                    const v = vehicles.find(x=>x.id===o.vehicleId);
                                    return (
                                        <div key={o.id} className="bg-white p-4 rounded shadow-sm">
                                            <div className="flex justify-between mb-1">
                                                <span className="font-bold">{o.customer}</span>
                                                <span className="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded">{o.status}</span>
                                            </div>
                                            <div className="text-sm text-gray-800 mb-1">
                                                {v?.plate || 'è»Šè¼›å·²åˆªé™¤'}
                                                {v?.feature ? ` (${v.feature})` : ''}
                                            </div>
                                            <div className="text-xs text-gray-500 mb-1 flex items-center gap-1">
                                                <span>{formatDateTime(o.start)}</span>
                                                <ArrowRight size={10} />
                                                <span>{formatDateTime(o.end)}</span>
                                            </div>
                                            <div className="text-xs text-slate-500 flex gap-2 mb-2">
                                                <span className="bg-slate-50 px-1 rounded border">å–: {o.pickupLocation}</span>
                                                <span className="bg-slate-50 px-1 rounded border">é‚„: {o.returnLocation}</span>
                                            </div>
                                            {/* è¨‚å–®åˆ—è¡¨çš„å‚™è¨»é¡¯ç¤º */}
                                            {o.note && (
                                                <div className="text-xs text-gray-500 mb-3 bg-gray-50 p-2 rounded border border-gray-100">
                                                    <span className="font-semibold text-gray-600">å‚™è¨»ï¼š</span>{o.note}
                                                </div>
                                            )}
                                            <div className="flex justify-end gap-3 border-t pt-2 mt-2">
                                                <button onClick={()=>{setEditingOrder(o); setOrderFormData(o); setIsOrderModalOpen(true)}} className="text-sm text-blue-600">ç·¨è¼¯</button>
                                                <button onClick={()=>handleDeleteOrder(o.id)} className="text-sm text-red-600">åˆªé™¤</button>
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        )}
                    </main>

                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-3 z-20 text-xs">
                        <button onClick={()=>setActiveTab('dashboard')} className={`flex flex-col items-center ${activeTab==='dashboard'?'text-blue-600':'text-gray-400'}`}><Calendar size={20}/><span>çœ‹æ¿</span></button>
                        <button onClick={()=>setActiveTab('vehicles')} className={`flex flex-col items-center ${activeTab==='vehicles'?'text-blue-600':'text-gray-400'}`}><Car size={20}/><span>è»Šè¼›</span></button>
                        <button onClick={()=>setActiveTab('orders')} className={`flex flex-col items-center ${activeTab==='orders'?'text-blue-600':'text-gray-400'}`}><Users size={20}/><span>è¨‚å–®</span></button>
                    </div>

                    {isOrderModalOpen && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-md rounded-lg p-5 max-h-[90vh] overflow-y-auto shadow-2xl">
                                <h3 className="font-bold text-lg mb-4">{editingOrder?'ç·¨è¼¯':'æ–°å¢'}è¨‚å–®</h3>
                                <form onSubmit={handleSaveOrder} className="space-y-3">
                                    <input placeholder="å®¢æˆ¶å§“å" className="w-full border p-2 rounded" value={orderFormData.customer} onChange={e=>setOrderFormData({...orderFormData, customer:e.target.value})} required/>
                                    
                                    <div className="grid grid-cols-2 gap-2">
                                        <div>
                                            <label className="text-xs block mb-1">å–è»Š</label>
                                            <input type="datetime-local" className="w-full border p-2 rounded text-sm" value={orderFormData.start} onChange={e=>setOrderFormData({...orderFormData, start:e.target.value})} required/>
                                        </div>
                                        <div>
                                            <label className="text-xs block mb-1">é‚„è»Š</label>
                                            <input type="datetime-local" className="w-full border p-2 rounded text-sm" value={orderFormData.end} onChange={e=>setOrderFormData({...orderFormData, end:e.target.value})} required/>
                                        </div>
                                    </div>

                                    {/* åœ°é»é¸æ“‡ */}
                                    <datalist id="location-options">
                                        {PRESET_LOCATIONS.map(loc => <option key={loc} value={loc} />)}
                                    </datalist>
                                    <div className="grid grid-cols-2 gap-2">
                                        <div>
                                            <label className="text-xs block mb-1">äº¤è»Šåœ°é»</label>
                                            <input 
                                                list="location-options"
                                                className="w-full border p-2 rounded text-sm" 
                                                placeholder="é¸æ“‡æˆ–è¼¸å…¥"
                                                value={orderFormData.pickupLocation} 
                                                onChange={e=>setOrderFormData({...orderFormData, pickupLocation:e.target.value})} 
                                            />
                                        </div>
                                        <div>
                                            <label className="text-xs block mb-1">é‚„è»Šåœ°é»</label>
                                            <input 
                                                list="location-options"
                                                className="w-full border p-2 rounded text-sm" 
                                                placeholder="é¸æ“‡æˆ–è¼¸å…¥"
                                                value={orderFormData.returnLocation} 
                                                onChange={e=>setOrderFormData({...orderFormData, returnLocation:e.target.value})} 
                                            />
                                        </div>
                                    </div>

                                    {/* å‚™è¨»æ¬„ä½ */}
                                    <div>
                                        <label className="text-xs block mb-1">å‚™è¨»äº‹é … (é¸å¡«)</label>
                                        <textarea 
                                            className="w-full border p-2 rounded text-sm" 
                                            rows="2"
                                            placeholder="è«‹è¼¸å…¥å…¶ä»–éœ€æ±‚æˆ–å‚™è¨» (å¦‚ï¼šèˆªç­è™Ÿç¢¼ã€å¬°å…’åº§æ¤…ç­‰)..."
                                            value={orderFormData.note} 
                                            onChange={e=>setOrderFormData({...orderFormData, note:e.target.value})} 
                                        ></textarea>
                                    </div>

                                    <div className="space-y-2 max-h-60 overflow-y-auto pr-1 border-t pt-2">
                                        <div className="text-xs text-gray-500 mb-1">é¸æ“‡è»Šè¼›:</div>
                                        {vehicles.map(v=>{
                                            const available = isVehicleAvailable(v.id, orderFormData.start, orderFormData.end, editingOrder?.id);
                                            // ä¿®æ­£ï¼šç§»é™¤ Number() è½‰å‹ï¼Œå› ç‚º Firestore ID æ˜¯å­—ä¸²
                                            const isSelected = orderFormData.vehicleId === v.id;
                                            return (
                                                <label 
                                                    key={v.id} 
                                                    className={`
                                                        relative flex items-center justify-between p-3 border rounded-lg cursor-pointer transition-all
                                                        ${isSelected ? 'border-blue-500 bg-blue-50 ring-1 ring-blue-500' : 'border-gray-200 hover:bg-gray-50'}
                                                        ${!available ? 'opacity-50 bg-gray-100 cursor-not-allowed' : ''}
                                                    `}
                                                >
                                                    <div className="flex items-center gap-3">
                                                        {/* é¸å–ç‹€æ…‹ï¼šæ”¹ç”¨ CheckCircle åœ–ç¤º */}
                                                        {isSelected ? (
                                                            <CheckCircle className="w-5 h-5 text-blue-600" />
                                                        ) : (
                                                            <div className="w-5 h-5 rounded-full border border-gray-400" />
                                                        )}
                                                        
                                                        <div className="flex flex-col">
                                                            <div className="font-bold text-slate-800 text-sm">
                                                                {v.plate} 
                                                            </div>
                                                            <div className="text-xs text-gray-500 flex flex-wrap gap-1 items-center">
                                                                <span>{v.model}</span>
                                                                {v.feature && (
                                                                    <>
                                                                        <span className="text-gray-300">|</span>
                                                                        <span className="font-medium text-blue-600">{v.feature}</span>
                                                                    </>
                                                                )}
                                                                {v.tire && (
                                                                    <>
                                                                        <span className="text-gray-300">|</span>
                                                                        <span>{v.tire}</span>
                                                                    </>
                                                                )}
                                                                {v.seats && (
                                                                    <>
                                                                        <span className="text-gray-300">|</span>
                                                                        <span>{v.seats} åº§</span>
                                                                    </>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    {!available && <span className="text-xs text-red-500 font-bold px-2 py-1 bg-red-100 rounded">å·²ç§Ÿå€Ÿ</span>}
                                                    
                                                    {/* éš±è—çš„åŸç”Ÿ Radio */}
                                                    <input 
                                                        type="radio" 
                                                        name="vid" 
                                                        className="hidden" 
                                                        checked={isSelected} 
                                                        onChange={()=> available && setOrderFormData({...orderFormData, vehicleId:v.id})} 
                                                        disabled={!available} 
                                                    />
                                                </label>
                                            );
                                        })}
                                    </div>
                                    <div className="flex gap-2 justify-end pt-2 border-t mt-2">
                                        <button type="button" onClick={()=>setIsOrderModalOpen(false)} className="px-4 py-2 border rounded hover:bg-slate-50 text-slate-700">å–æ¶ˆ</button>
                                        <button type="submit" className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">å„²å­˜</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {isVehicleModalOpen && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-md rounded-lg p-5 shadow-2xl">
                                <h3 className="font-bold text-lg mb-4">{editingVehicle?'ç·¨è¼¯':'æ–°å¢'}è»Šè¼›</h3>
                                <form onSubmit={handleSaveVehicle} className="space-y-3">
                                    <input placeholder="è»Šç‰Œ" className="w-full border p-2 rounded" value={vehicleFormData.plate} onChange={e=>setVehicleFormData({...vehicleFormData, plate:e.target.value})} required/>
                                    <div className="flex gap-2">
                                        <input placeholder="è»Šå‹" className="w-full border p-2 rounded" value={vehicleFormData.model} onChange={e=>setVehicleFormData({...vehicleFormData, model:e.target.value})} required/>
                                        <input placeholder="ç‰¹å¾µ (å¦‚: HEV 4WD)" className="w-full border p-2 rounded" value={vehicleFormData.feature} onChange={e=>setVehicleFormData({...vehicleFormData, feature:e.target.value})} />
                                    </div>
                                    <div className="flex gap-2">
                                        <input type="number" placeholder="åº§ä½æ•¸" className="w-1/3 border p-2 rounded" value={vehicleFormData.seats} onChange={e=>setVehicleFormData({...vehicleFormData, seats:e.target.value})} />
                                        <select className="w-2/3 border p-2 rounded" value={vehicleFormData.tire} onChange={e=>setVehicleFormData({...vehicleFormData, tire:e.target.value})}>
                                            <option value="å†¬æ¸ˆ">å†¬èƒ</option><option value="å¤æ¸ˆ">å¤èƒ</option>
                                        </select>
                                    </div>
                                    <div className="space-y-2">
                                        <select className="w-full border p-2 rounded" value={vehicleFormData.etc} onChange={e=>setVehicleFormData({...vehicleFormData, etc:e.target.value})}>
                                                <option value="">-- ETC é…ç½® --</option>
                                                {Array.from(new Set(vehicles.map(v=>v.etc).filter(Boolean))).concat(newEtcNumber ? [newEtcNumber] : []).map(etc => (
                                                    <option key={etc} value={etc}>{etc}</option>
                                                ))}
                                        </select>
                                        <div className="flex gap-2">
                                            <input placeholder="æ–°å¡è™Ÿ" className="w-full border p-2 rounded text-sm" value={newEtcNumber} onChange={e=>setNewEtcNumber(e.target.value)}/>
                                            <button type="button" onClick={()=>newEtcNumber && (setVehicleFormData({...vehicleFormData, etc:newEtcNumber}), setNewEtcNumber(''))} className="px-3 py-1 bg-green-500 text-white rounded text-xs whitespace-nowrap">æ–°å¢</button>
                                        </div>
                                    </div>
                                    <div className="flex gap-2 justify-end pt-2">
                                        <button type="button" onClick={()=>setIsVehicleModalOpen(false)} className="px-4 py-2 border rounded hover:bg-slate-50 text-slate-700">å–æ¶ˆ</button>
                                        <button type="submit" className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">å„²å­˜</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<VehicleOrderSystem />);
    </script>
</body>
</html>
